# üìã DOCUMENTO DE REQUISITOS COMPLETO
## Sistema de Gest√£o para Professores Aut√¥nomos

**Vers√£o:** 1.0  
**Data:** 30/12/2024  
**Status:** Documento Final para Desenvolvimento

---

## üìë √çNDICE

1. [Vis√£o Geral](#1-vis√£o-geral)
2. [Requisitos Funcionais](#2-requisitos-funcionais)
3. [Requisitos N√£o-Funcionais](#3-requisitos-n√£o-funcionais)
4. [Regras de Neg√≥cio](#4-regras-de-neg√≥cio)
5. [Integra√ß√µes Externas](#5-integra√ß√µes-externas)
6. [Modelo de Dados](#6-modelo-de-dados)
7. [Fluxos de Usu√°rio](#7-fluxos-de-usu√°rio)
8. [Seguran√ßa e Compliance](#8-seguran√ßa-e-compliance)
9. [Roadmap de Desenvolvimento](#9-roadmap-de-desenvolvimento)

---

## 1. VIS√ÉO GERAL

### 1.1 Objetivo do Sistema

Plataforma SaaS multi-tenant para professores aut√¥nomos gerenciarem alunos, mensalidades, agendamentos e comunica√ß√£o de forma simples, r√°pida e profissional.

### 1.2 P√∫blico-Alvo

- Professores particulares (idiomas, m√∫sica, refor√ßo escolar)
- Instrutores de atividades f√≠sicas (artes marciais, personal, yoga)
- Professores online (cursos, mentorias, coaching)
- Microescolas e est√∫dios pequenos

### 1.3 Proposta de Valor

- ‚ö° **R√°pido:** Cadastro de aluno em < 1 minuto
- üí∞ **Completo:** Gest√£o financeira + cobran√ßa automatizada
- üì± **Simples:** Interface intuitiva, mobile-first
- üîó **Integrado:** EfiBank para PIX/Boleto + WhatsApp nativo
- üåê **P√∫blico:** Formul√°rios de capta√ß√£o de leads

### 1.4 Diferenciais

- Sem custo de API WhatsApp (usa links nativos)
- Integra√ß√£o direta com EfiBank (PIX + Boleto)
- Formul√°rios p√∫blicos de pr√©-agendamento e matr√≠cula
- Contratos digitais com assinatura eletr√¥nica
- Multi-tenancy (cada professor isolado)
- Cobran√ßa recorrente automatizada

---

## 2. REQUISITOS FUNCIONAIS

### 2.1 RF001 - AUTENTICA√á√ÉO E USU√ÅRIO

| ID | Descri√ß√£o | Prioridade | Sprint |
|----|-----------|------------|--------|
| RF001.1 | Cadastro com email/senha | üî¥ Alta | 1 |
| RF001.2 | Login com email/senha | üî¥ Alta | 1 |
| RF001.3 | Recupera√ß√£o de senha via email | üü° M√©dia | 2 |
| RF001.4 | Perfil do professor (nome, foto, contatos, dados banc√°rios) | üî¥ Alta | 1 |
| RF001.5 | Logout | üî¥ Alta | 1 |
| RF001.6 | Alterar senha | üü° M√©dia | 2 |
| RF001.7 | Autentica√ß√£o JWT com refresh token | üî¥ Alta | 1 |

---

### 2.2 RF002 - GERENCIAMENTO DE ALUNOS

| ID | Descri√ß√£o | Prioridade | Sprint |
|----|-----------|------------|--------|
| RF002.1 | Cadastrar aluno (nome, email, telefone, WhatsApp) | üî¥ Alta | 1 |
| RF002.2 | Editar dados do aluno | üî¥ Alta | 1 |
| RF002.3 | Excluir aluno (soft delete) | üü° M√©dia | 2 |
| RF002.4 | Listar alunos com busca por nome/telefone/email | üî¥ Alta | 1 |
| RF002.5 | Filtrar alunos por status (ativo/inativo) | üü° M√©dia | 2 |
| RF002.6 | Filtrar alunos por tipo de aula | üü° M√©dia | 2 |
| RF002.7 | Visualizar detalhes completos do aluno | üî¥ Alta | 1 |
| RF002.8 | Marcar aluno como ativo/inativo | üü° M√©dia | 2 |
| RF002.9 | Associar aluno a tipo de aula | üî¥ Alta | 1 |
| RF002.10 | Bot√£o "Enviar WhatsApp" (abre link direto) | üî¥ Alta | 1 |
| RF002.11 | Visualizar hist√≥rico de mensalidades do aluno | üî¥ Alta | 2 |
| RF002.12 | Visualizar hist√≥rico de presen√ßa do aluno | üü° M√©dia | 3 |
| RF002.13 | Cadastro r√°pido (modal com campos essenciais) | üü° M√©dia | 2 |

**Campos do Aluno:**
- Nome completo (obrigat√≥rio)
- Email (opcional, √∫nico por professor)
- Telefone (obrigat√≥rio)
- WhatsApp (obrigat√≥rio, formatado +5569...)
- CPF (opcional)
- Data de nascimento (opcional)
- Endere√ßo completo (opcional)
- Tipo de aula (obrigat√≥rio, FK)
- Status (ativo/inativo)
- Observa√ß√µes (textarea)
- Data de cadastro (auto)
- Data de √∫ltima atualiza√ß√£o (auto)

---

### 2.3 RF003 - TIPOS DE AULA

| ID | Descri√ß√£o | Prioridade | Sprint |
|----|-----------|------------|--------|
| RF003.1 | Cadastrar tipo de aula | üî¥ Alta | 1 |
| RF003.2 | Editar tipo de aula | üî¥ Alta | 1 |
| RF003.3 | Excluir tipo de aula (se n√£o tiver alunos) | üü° M√©dia | 2 |
| RF003.4 | Listar tipos de aula | üî¥ Alta | 1 |
| RF003.5 | Definir pre√ßo padr√£o mensal | üî¥ Alta | 1 |
| RF003.6 | Definir descri√ß√£o do tipo | üü° M√©dia | 2 |
| RF003.7 | Definir cor de identifica√ß√£o visual | üü° M√©dia | 2 |
| RF003.8 | Marcar tipo como ativo/inativo | üü° M√©dia | 2 |

---

### 2.4 RF004 - MENSALIDADES E COBRAN√áAS

| ID | Descri√ß√£o | Prioridade | Sprint |
|----|-----------|------------|--------|
| RF004.1 | Gerar mensalidade individual (m√™s/ano espec√≠fico) | üî¥ Alta | 1 |
| RF004.2 | Gerar mensalidades em lote (todos alunos ativos) | üî¥ Alta | 1 |
| RF004.3 | Editar valor da mensalidade | üî¥ Alta | 1 |
| RF004.4 | Editar data de vencimento | üî¥ Alta | 1 |
| RF004.5 | Marcar como pago manualmente | üî¥ Alta | 1 |
| RF004.6 | Gerar PIX via EfiBank | üî¥ Alta | 2 |
| RF004.7 | Gerar boleto via EfiBank | üü° M√©dia | 3 |
| RF004.8 | Cancelar mensalidade | üü° M√©dia | 2 |
| RF004.9 | Listar mensalidades com filtros (status, per√≠odo, aluno) | üî¥ Alta | 1 |
| RF004.10 | Visualizar detalhes da mensalidade | üî¥ Alta | 1 |
| RF004.11 | Enviar cobran√ßa via WhatsApp (link + mensagem) | üî¥ Alta | 1 |
| RF004.12 | Baixa autom√°tica via webhook EfiBank | üî¥ Alta | 2 |
| RF004.13 | Calcular juros e multa por atraso | üü° M√©dia | 3 |
| RF004.14 | Hist√≥rico de transa√ß√µes da mensalidade | üü° M√©dia | 2 |
| RF004.15 | Exportar lista de mensalidades (Excel/PDF) | üü° M√©dia | 3 |

---

### 2.5 RF005 - INTEGRA√á√ÉO EFIBANK

| ID | Descri√ß√£o | Prioridade | Sprint |
|----|-----------|------------|--------|
| RF005.1 | Configurar credenciais (Client ID, Secret, Certificado) | üî¥ Alta | 2 |
| RF005.2 | Gerar cobran√ßa PIX via API | üî¥ Alta | 2 |
| RF005.3 | Receber PIX Copia e Cola | üî¥ Alta | 2 |
| RF005.4 | Receber QR Code do PIX (URL da imagem) | üî¥ Alta | 2 |
| RF005.5 | Webhook para notifica√ß√£o de pagamento | üî¥ Alta | 2 |
| RF005.6 | Validar assinatura do webhook | üî¥ Alta | 2 |
| RF005.7 | Gerar boleto via API | üü° M√©dia | 3 |
| RF005.8 | Consultar status de cobran√ßa | üü° M√©dia | 3 |
| RF005.9 | Cancelar cobran√ßa PIX/Boleto | ‚ö™ Baixa | 4 |
| RF005.10 | Alternar entre sandbox e produ√ß√£o | üî¥ Alta | 2 |

---

### 2.6 RF006 - DASHBOARD E RELAT√ìRIOS

| ID | Descri√ß√£o | Prioridade | Sprint |
|----|-----------|------------|--------|
| RF006.1 | Dashboard com resumo financeiro do m√™s | üî¥ Alta | 1 |
| RF006.2 | Cards: Recebido, A Receber, Inadimpl√™ncia, Total Alunos | üî¥ Alta | 1 |
| RF006.3 | Gr√°fico de receita mensal (√∫ltimos 6 meses) | üî¥ Alta | 2 |
| RF006.4 | Gr√°fico comparativo: esperado vs recebido | üü° M√©dia | 2 |
| RF006.5 | Lista de inadimplentes | üî¥ Alta | 1 |
| RF006.6 | Lista de mensalidades a vencer (pr√≥ximos 7 dias) | üî¥ Alta | 1 |
| RF006.7 | Filtro por per√≠odo (m√™s/ano) | üü° M√©dia | 2 |
| RF006.8 | Filtro por tipo de aula | üü° M√©dia | 2 |
| RF006.9 | Exportar relat√≥rio financeiro (Excel) | üü° M√©dia | 3 |
| RF006.10 | Exportar relat√≥rio financeiro (PDF) | üü° M√©dia | 3 |
| RF006.11 | Relat√≥rio de inadimpl√™ncia detalhado | üü° M√©dia | 3 |
| RF006.12 | Alertas visuais (mensalidades vencendo, PIX expirados) | üü° M√©dia | 2 |
| RF006.13 | Cards de pr√©-agendamentos e pr√©-matr√≠culas pendentes | üî¥ Alta | 2 |

---

### 2.7 RF007 - NOTIFICA√á√ïES VIA WHATSAPP

| ID | Descri√ß√£o | Prioridade | Sprint |
|----|-----------|------------|--------|
| RF007.1 | Templates de mensagens (Cobran√ßa, Lembrete, Agradecimento, Aviso) | üî¥ Alta | 1 |
| RF007.2 | Enviar mensagem individual (abre WhatsApp com link) | üî¥ Alta | 1 |
| RF007.3 | Envio em lote assistido (abre sequencialmente) | üî¥ Alta | 2 |
| RF007.4 | Vari√°veis din√¢micas ([NOME], [VALOR], [DATA], [PIX]) | üî¥ Alta | 1 |
| RF007.5 | Editar template antes de enviar | üü° M√©dia | 2 |
| RF007.6 | Hist√≥rico de notifica√ß√µes enviadas | üü° M√©dia | 2 |
| RF007.7 | Incluir PIX copia e cola na mensagem | üî¥ Alta | 2 |
| RF007.8 | Incluir link do boleto na mensagem | üü° M√©dia | 3 |
| RF007.9 | Filtrar destinat√°rios (inadimplentes, por tipo, todos) | üî¥ Alta | 2 |
| RF007.10 | Preview da mensagem antes de enviar | üü° M√©dia | 2 |

---

### 2.8 RF008 - AGENDA DE AULAS

| ID | Descri√ß√£o | Prioridade | Sprint |
|----|-----------|------------|--------|
| RF008.1 | Visualizar calend√°rio mensal | üü° M√©dia | 3 |
| RF008.2 | Visualizar calend√°rio semanal | üü° M√©dia | 3 |
| RF008.3 | Agendar aula para aluno (data/hora/dura√ß√£o) | üü° M√©dia | 3 |
| RF008.4 | Editar aula agendada | üü° M√©dia | 3 |
| RF008.5 | Cancelar aula | üü° M√©dia | 3 |
| RF008.6 | Marcar presen√ßa/falta | üü° M√©dia | 3 |
| RF008.7 | Aulas recorrentes (semanal) | ‚ö™ Baixa | 4 |
| RF008.8 | Notifica√ß√£o de aula pr√≥xima (1 dia antes) | ‚ö™ Baixa | 4 |
| RF008.9 | Visualizar hist√≥rico de aulas do aluno | üü° M√©dia | 3 |
| RF008.10 | Filtrar agenda por aluno/tipo de aula | üü° M√©dia | 3 |

---

### 2.9 RF009 - CONTROLE DE PRESEN√áA

| ID | Descri√ß√£o | Prioridade | Sprint |
|----|-----------|------------|--------|
| RF009.1 | Marcar presen√ßa individual | üü° M√©dia | 3 |
| RF009.2 | Marcar falta individual | üü° M√©dia | 3 |
| RF009.3 | Marcar falta justificada | üü° M√©dia | 3 |
| RF009.4 | Hist√≥rico de frequ√™ncia por aluno | üü° M√©dia | 3 |
| RF009.5 | Percentual de presen√ßa do aluno | ‚ö™ Baixa | 4 |
| RF009.6 | Relat√≥rio de frequ√™ncia mensal (todos alunos) | ‚ö™ Baixa | 4 |
| RF009.7 | Exportar relat√≥rio de frequ√™ncia (Excel/PDF) | ‚ö™ Baixa | 4 |

---

### 2.10 RF010 - CONFIGURA√á√ïES

| ID | Descri√ß√£o | Prioridade | Sprint |
|----|-----------|------------|--------|
| RF010.1 | Editar perfil do professor | üî¥ Alta | 1 |
| RF010.2 | Configurar dados banc√°rios (PIX) | üî¥ Alta | 1 |
| RF010.3 | Configurar credenciais EfiBank | üî¥ Alta | 2 |
| RF010.4 | Personalizar templates de mensagem | üü° M√©dia | 2 |
| RF010.5 | Configurar dia padr√£o de vencimento | üü° M√©dia | 2 |
| RF010.6 | Configurar taxa de multa (%) | üü° M√©dia | 3 |
| RF010.7 | Configurar taxa de juros (% ao m√™s) | üü° M√©dia | 3 |
| RF010.8 | Configurar validade do PIX (horas) | üü° M√©dia | 3 |
| RF010.9 | Configurar validade do boleto (dias) | üü° M√©dia | 3 |
| RF010.10 | Configurar notifica√ß√µes (email, in-app) | üü° M√©dia | 2 |
| RF010.11 | Backup manual de dados (export JSON) | ‚ö™ Baixa | 4 |

---

### 2.11 RF011 - FORMUL√ÅRIO P√öBLICO DE PR√â-AGENDAMENTO

| ID | Descri√ß√£o | Prioridade | Sprint |
|----|-----------|------------|--------|
| RF011.1 | Gerar link p√∫blico √∫nico (/agendar/:slug) | üî¥ Alta | 2 |
| RF011.2 | Formul√°rio responsivo (mobile-first) | üî¥ Alta | 2 |
| RF011.3 | Campos: nome, telefone, tipo de aula, data/hora preferida | üî¥ Alta | 2 |
| RF011.4 | Valida√ß√£o em tempo real (frontend) | üü° M√©dia | 2 |
| RF011.5 | Ao submeter, salvar pr√©-agendamento no sistema | üî¥ Alta | 2 |
| RF011.6 | Ao submeter, abrir WhatsApp do professor | üî¥ Alta | 2 |
| RF011.7 | Mensagem WhatsApp pr√©-formatada com dados | üî¥ Alta | 2 |
| RF011.8 | Professor v√™ lista de pr√©-agendamentos no admin | üî¥ Alta | 2 |
| RF011.9 | Professor pode confirmar pr√©-agendamento | üü° M√©dia | 2 |
| RF011.10 | Professor pode cancelar pr√©-agendamento | üü° M√©dia | 2 |
| RF011.11 | Converter pr√©-agendamento em aluno (1 clique) | üü° M√©dia | 3 |
| RF011.12 | Personalizar slug do link | üü° M√©dia | 2 |
| RF011.13 | Personalizar cores e logo do formul√°rio | üü° M√©dia | 3 |
| RF011.14 | reCAPTCHA para evitar spam | üü° M√©dia | 3 |
| RF011.15 | Gerar QR Code do link | üü° M√©dia | 3 |

---

### 2.12 RF012 - FORMUL√ÅRIO P√öBLICO DE PR√â-MATR√çCULA

| ID | Descri√ß√£o | Prioridade | Sprint |
|----|-----------|------------|--------|
| RF012.1 | Gerar link p√∫blico √∫nico (/matricula/:slug) | üî¥ Alta | 2 |
| RF012.2 | Formul√°rio completo com dados do aluno | üî¥ Alta | 2 |
| RF012.3 | Upload de documentos (RG, CPF, comprovante) | üü° M√©dia | 3 |
| RF012.4 | Gerar contrato digital automaticamente | üî¥ Alta | 2 |
| RF012.5 | Assinatura eletr√¥nica (checkbox + timestamp + IP) | üî¥ Alta | 2 |
| RF012.6 | Ao submeter, salvar pr√©-matr√≠cula + abrir WhatsApp | üî¥ Alta | 2 |
| RF012.7 | Professor aprova ou rejeita matr√≠cula | üî¥ Alta | 2 |
| RF012.8 | Converter em aluno oficial (1 clique) | üî¥ Alta | 2 |
| RF012.9 | Gerar primeira mensalidade automaticamente na convers√£o | üü° M√©dia | 3 |
| RF012.10 | Enviar email de confirma√ß√£o ao interessado | üü° M√©dia | 3 |
| RF012.11 | Professor edita template de contrato | üü° M√©dia | 2 |
| RF012.12 | Validar CPF √∫nico (n√£o pode duplicar) | üî¥ Alta | 2 |
| RF012.13 | Dados de respons√°vel (se menor de 18 anos) | üî¥ Alta | 2 |
| RF012.14 | Buscar CEP automaticamente (API ViaCEP) | üü° M√©dia | 2 |

---

## 3. REQUISITOS N√ÉO-FUNCIONAIS

### 3.1 RNF001 - PERFORMANCE

| ID | Descri√ß√£o | M√©trica | Prioridade |
|----|-----------|---------|------------|
| RNF001.1 | Tempo de carregamento inicial | < 3 segundos | üî¥ Alta |
| RNF001.2 | Tempo de carregamento do dashboard | < 2 segundos | üî¥ Alta |
| RNF001.3 | Tempo de resposta da API | < 500ms (95% req) | üî¥ Alta |
| RNF001.4 | Tempo de gera√ß√£o de PIX | < 3 segundos | üî¥ Alta |
| RNF001.5 | Suportar requisi√ß√µes simult√¢neas | 100 req/s | üü° M√©dia |
| RNF001.6 | Cache de dados do dashboard | 5 minutos | üü° M√©dia |
| RNF001.7 | Otimiza√ß√£o de imagens | Lazy loading | üü° M√©dia |
| RNF001.8 | Minifica√ß√£o de assets (JS/CSS) | Sim | üî¥ Alta |

---

### 3.2 RNF002 - USABILIDADE

| ID | Descri√ß√£o | M√©trica | Prioridade |
|----|-----------|---------|------------|
| RNF002.1 | Interface intuitiva | N√£o requer treinamento | üî¥ Alta |
| RNF002.2 | Design mobile-first | 100% responsivo | üî¥ Alta |
| RNF002.3 | M√°ximo de cliques para a√ß√£o | ‚â§ 3 cliques | üî¥ Alta |
| RNF002.4 | Feedback visual | Todas a√ß√µes | üî¥ Alta |
| RNF002.5 | Mensagens de erro claras | Linguagem simples | üî¥ Alta |
| RNF002.6 | Acessibilidade (WCAG 2.1) | N√≠vel AA | üü° M√©dia |
| RNF002.7 | Atalhos de teclado | Principais a√ß√µes | ‚ö™ Baixa |
| RNF002.8 | Tour guiado (onboarding) | Sim | üü° M√©dia |

---

### 3.3 RNF003 - SEGURAN√áA

| ID | Descri√ß√£o | Implementa√ß√£o | Prioridade |
|----|-----------|--------------|------------|
| RNF003.1 | Comunica√ß√£o segura | HTTPS obrigat√≥rio | üî¥ Alta |
| RNF003.2 | Hash de senhas | bcrypt (rounds: 12) | üî¥ Alta |
| RNF003.3 | Autentica√ß√£o | JWT + Refresh Token | üî¥ Alta |
| RNF003.4 | Expira√ß√£o de tokens | Access: 15min, Refresh: 7d | üî¥ Alta |
| RNF003.5 | Prote√ß√£o CSRF | Token CSRF | üî¥ Alta |
| RNF003.6 | Rate limiting | 100 req/min por IP | üî¥ Alta |
| RNF003.7 | Criptografia de dados sens√≠veis | AES-256 | üî¥ Alta |
| RNF003.8 | Valida√ß√£o de entrada | Server-side sempre | üî¥ Alta |
| RNF003.9 | Sanitiza√ß√£o de dados | SQL Injection, XSS | üî¥ Alta |
| RNF003.10 | Logs de auditoria | A√ß√µes cr√≠ticas | üü° M√©dia |
| RNF003.11 | Backup criptografado | Di√°rio | üî¥ Alta |

---

### 3.4 RNF004 - DISPONIBILIDADE

| ID | Descri√ß√£o | M√©trica | Prioridade |
|----|-----------|---------|------------|
| RNF004.1 | Uptime m√≠nimo | 99.5% | üî¥ Alta |
| RNF004.2 | Backup autom√°tico | Di√°rio (3h da manh√£) | üî¥ Alta |
| RNF004.3 | Reten√ß√£o de backups | 30 dias | üî¥ Alta |
| RNF004.4 | RTO (Recovery Time Objective) | < 4 horas | üü° M√©dia |
| RNF004.5 | RPO (Recovery Point Objective) | < 24 horas | üü° M√©dia |
| RNF004.6 | Monitoramento | 24/7 | üî¥ Alta |
| RNF004.7 | Alertas autom√°ticos | Downtime, erros cr√≠ticos | üî¥ Alta |

---

### 3.5 RNF005 - ESCALABILIDADE

| ID | Descri√ß√£o | Capacidade | Prioridade |
|----|-----------|-----------|------------|
| RNF005.1 | N√∫mero de professores | At√© 10.000 | üü° M√©dia |
| RNF005.2 | N√∫mero de alunos | At√© 500.000 | üü° M√©dia |
| RNF005.3 | N√∫mero de mensalidades | At√© 1.000.000 | üü° M√©dia |
| RNF005.4 | Arquitetura stateless | Horizontal scaling | üî¥ Alta |
| RNF005.5 | Banco de dados | Suporta sharding | üü° M√©dia |
| RNF005.6 | CDN para assets est√°ticos | Sim | üü° M√©dia |
| RNF005.7 | Load balancer | Auto-scaling | üü° M√©dia |

---

### 3.6 RNF006 - COMPATIBILIDADE

| ID | Descri√ß√£o | Suporte | Prioridade |
|----|-----------|---------|------------|
| RNF006.1 | Navegadores desktop | Chrome, Firefox, Safari, Edge (√∫ltimas 2 vers√µes) | üî¥ Alta |
| RNF006.2 | Navegadores mobile | Chrome Mobile, Safari Mobile | üî¥ Alta |
| RNF006.3 | Sistemas operacionais mobile | iOS 13+, Android 8+ | üî¥ Alta |
| RNF006.4 | Resolu√ß√µes suportadas | 320px - 2560px | üî¥ Alta |
| RNF006.5 | Progressive Web App (PWA) | Instal√°vel | üü° M√©dia |
| RNF006.6 | Modo offline (leitura) | Sim | ‚ö™ Baixa |

---

### 3.7 RNF007 - MANUTENIBILIDADE

| ID | Descri√ß√£o | Implementa√ß√£o | Prioridade |
|----|-----------|--------------|------------|
| RNF007.1 | C√≥digo documentado | JSDoc, coment√°rios | üî¥ Alta |
| RNF007.2 | Testes automatizados | Coverage > 80% | üî¥ Alta |
| RNF007.3 | Testes unit√°rios | Jest | üî¥ Alta |
| RNF007.4 | Testes de integra√ß√£o | Supertest | üü° M√©dia |
| RNF007.5 | Testes E2E | Playwright/Cypress | üü° M√©dia |
| RNF007.6 | Logs estruturados | Winston/Pino | üî¥ Alta |
| RNF007.7 | Monitoramento de erros | Sentry | üî¥ Alta |
| RNF007.8 | Linter | ESLint | üî¥ Alta |
| RNF007.9 | Formata√ß√£o de c√≥digo | Prettier | üî¥ Alta |
| RNF007.10 | Versionamento sem√¢ntico | SemVer | üî¥ Alta |

---

### 3.8 RNF008 - CONFORMIDADE

| ID | Descri√ß√£o | Padr√£o | Prioridade |
|----|-----------|--------|------------|
| RNF008.1 | LGPD (Lei Geral de Prote√ß√£o de Dados) | Compliance total | üî¥ Alta |
| RNF008.2 | Termo de uso | Exibido e aceito | üî¥ Alta |
| RNF008.3 | Pol√≠tica de privacidade | Exibida e aceita | üî¥ Alta |
| RNF008.4 | Direito ao esquecimento | Export + Delete dados | üî¥ Alta |
| RNF008.5 | Consentimento expl√≠cito | Opt-in | üî¥ Alta |
| RNF008.6 | Criptografia de dados pessoais | AES-256 | üî¥ Alta |

---

## 4. REGRAS DE NEG√ìCIO

### 4.1 RN001-009 - GLOBAIS

**RN001 - Multi-Tenancy**
- Cada professor √© isolado (tenant)
- Queries sempre filtradas por `user_id`
- √çndices incluem `user_id`

**RN002 - Soft Delete**
- Exclus√µes l√≥gicas (`deleted_at`)
- Mant√©m hist√≥rico para auditoria

**RN003 - Auditoria**
- Registrar `created_at`, `updated_at`, `created_by`
- Logs de a√ß√µes sens√≠veis

**RN004-009** - Valida√ß√µes padr√£o de email, senha, telefone, valores monet√°rios, data/hora e pagina√ß√£o

### 4.2 RN010-029 - ALUNOS E TIPOS DE AULA

**RN010-019** - Regras de cadastro, valida√ß√£o e gest√£o de alunos
**RN020-029** - Regras de tipos de aula, pre√ßos e exclus√£o

### 4.3 RN030-049 - MENSALIDADES

**RN030** - Unicidade: n√£o duplicar aluno + m√™s + ano
**RN031** - Status inicial: "pendente"
**RN032** - Vencimento padr√£o: dia 10 (configur√°vel)
**RN033** - Status "vencida" atualizado automaticamente
**RN034** - Multa padr√£o: 2%
**RN035** - Juros padr√£o: 1% ao m√™s
**RN036** - F√≥rmula: `valor_final = valor_original + multa + juros`
**RN037** - PIX expira em 24h
**RN038** - Um PIX por mensalidade
**RN039-049** - Regras de gera√ß√£o em lote, baixa de pagamento, cancelamento e edi√ß√£o

### 4.4 RN050-069 - EFIBANK E PAGAMENTOS

**RN050** - Credenciais criptografadas (AES-256)
**RN051** - Ambientes: sandbox/produ√ß√£o
**RN052-059** - Regras de gera√ß√£o PIX, webhook, valida√ß√£o de assinatura, boletos e consultas

### 4.5 RN060-079 - NOTIFICA√á√ïES WHATSAPP

**RN060** - Mensagem m√°xima: 1.000 caracteres
**RN061** - Protocolo: `https://wa.me/[phone]?text=[message]`
**RN062** - Registrar timestamp da tentativa
**RN063** - Substitui√ß√£o de vari√°veis din√¢micas
**RN064-079** - Regras de hist√≥rico, templates, envio em lote

### 4.6 RN080-099 - AGENDA E PRESEN√áA

**RN080** - Presen√ßa marcada ap√≥s data/hora da aula
**RN081** - Falta justificada n√£o entra no c√°lculo negativo
**RN082** - Percentual: `(Presen√ßas / Total) * 100`
**RN083-099** - Regras de agendamento, cancelamento, recorr√™ncia

### 4.7 RN100-119 - FORMUL√ÅRIOS P√öBLICOS

**RN100** - Link √∫nico por professor (slug validado)
**RN101** - Formul√°rio acess√≠vel 24/7 sem autentica√ß√£o
**RN102** - Telefone validado (regex Brasil)
**RN103** - Status inicial pr√©-agendamento: "pendente"
**RN104** - Ao submeter: salvar + abrir WhatsApp
**RN105** - Notifica√ß√£o in-app imediata
**RN106** - N√£o permitir agendamento de datas passadas
**RN110** - CPF validado e √∫nico por professor
**RN111** - Email validado e √∫nico por professor
**RN112** - Menor de 18: dados do respons√°vel obrigat√≥rios
**RN113** - Contrato gerado dinamicamente
**RN114** - Aceite registrado: timestamp + IP
**RN115** - Status inicial matr√≠cula: "pendente_aprovacao"
**RN116** - Auto-rejeita ap√≥s 7 dias sem resposta
**RN117** - Documentos criptografados
**RN118** - Professor pode personalizar cl√°usulas
**RN119** - Na convers√£o: criar aluno + gerar mensalidade

---

## 5. INTEGRA√á√ïES EXTERNAS

### 5.1 EfiBank (Gerencianet)

**Autentica√ß√£o:**
- OAuth 2.0 Client Credentials
- Certificado .pem obrigat√≥rio

**Endpoints:**
```
POST /oauth/token - Autentica√ß√£o
POST /v2/cob - Criar cobran√ßa PIX
GET /v2/cob/:txid - Consultar PIX
POST /v1/carnet - Criar boleto
Webhook: POST /webhook/efibank
```

**Fluxo PIX:**
1. Professor clica "Gerar PIX"
2. Sistema chama API EfiBank
3. Recebe: txid, PIX copia e cola, QR Code
4. Salva na mensalidade
5. Aluno paga
6. EfiBank envia webhook
7. Sistema valida assinatura
8. Atualiza status para "paga"
9. Notifica professor

**Webhook Payload:**
```json
{
  "evento": "pix",
  "data_evento": "2024-12-30T10:30:00Z",
  "pix": [{
    "txid": "7978c0c97ea847e78e8849634473c1f1",
    "valor": "250.00",
    "horario": "2024-12-30T10:29:55Z"
  }]
}
```

### 5.2 ViaCEP

**Endpoint:**
```
GET https://viacep.com.br/ws/{cep}/json/
```

**Uso:** Buscar endere√ßo automaticamente no formul√°rio de matr√≠cula

### 5.3 WhatsApp (Link Nativo)

**Protocolo:**
```
https://wa.me/{phone}?text={message}
```

**Formato do telefone:** +5569999999999
**Codifica√ß√£o:** URL encode da mensagem

---

## 6. MODELO DE DADOS

### 6.1 Entidade: users (Professores)

```sql
id: UUID PRIMARY KEY
email: VARCHAR(255) UNIQUE NOT NULL
password_hash: VARCHAR(255) NOT NULL
name: VARCHAR(255) NOT NULL
phone: VARCHAR(20)
photo_url: VARCHAR(500)
specialty: VARCHAR(100)
bio: TEXT

-- Dados Banc√°rios
pix_key: VARCHAR(255)
pix_key_type: ENUM('cpf','email','phone','random')
bank_name: VARCHAR(100)
bank_agency: VARCHAR(10)
bank_account: VARCHAR(20)

-- Configura√ß√µes Financeiras
default_due_day: INT DEFAULT 10
late_fee_percent: DECIMAL(5,2) DEFAULT 2.00
interest_percent: DECIMAL(5,2) DEFAULT 1.00
pix_validity_hours: INT DEFAULT 24
boleto_validity_days: INT DEFAULT 7

-- EfiBank
efibank_client_id: VARCHAR(255) ENCRYPTED
efibank_client_secret: VARCHAR(255) ENCRYPTED
efibank_certificate: TEXT ENCRYPTED
efibank_environment: ENUM('sandbox','production')

-- Notifica√ß√µes
notify_in_app: BOOLEAN DEFAULT TRUE
notify_email: BOOLEAN DEFAULT TRUE
notification_email: VARCHAR(255)

-- Timestamps
created_at: TIMESTAMP DEFAULT NOW()
updated_at: TIMESTAMP DEFAULT NOW()
deleted_at: TIMESTAMP NULL

INDEX idx_email (email)
```

### 6.2 Entidade: class_types

```sql
id: UUID PRIMARY KEY
user_id: UUID FOREIGN KEY REFERENCES users
name: VARCHAR(100) NOT NULL
description: TEXT
default_price: DECIMAL(10,2) NOT NULL
color: VARCHAR(7) DEFAULT '#3B82F6'
is_active: BOOLEAN DEFAULT TRUE
created_at: TIMESTAMP DEFAULT NOW()
updated_at: TIMESTAMP DEFAULT NOW()
deleted_at: TIMESTAMP NULL

UNIQUE(user_id, name, deleted_at)
INDEX idx_user_active (user_id, is_active)
```

### 6.3 Entidade: students

```sql
id: UUID PRIMARY KEY
user_id: UUID FOREIGN KEY REFERENCES users
class_type_id: UUID FOREIGN KEY REFERENCES class_types
name: VARCHAR(255) NOT NULL
email: VARCHAR(255)
phone: VARCHAR(20) NOT NULL
whatsapp: VARCHAR(20) NOT NULL
cpf: VARCHAR(14)
birth_date: DATE
address_zip: VARCHAR(9)
address_street: VARCHAR(255)
address_number: VARCHAR(10)
address_complement: VARCHAR(100)
address_neighborhood: VARCHAR(100)
address_city: VARCHAR(100)
address_state: VARCHAR(2)
notes: TEXT
is_active: BOOLEAN DEFAULT TRUE
created_at: TIMESTAMP DEFAULT NOW()
updated_at: TIMESTAMP DEFAULT NOW()
deleted_at: TIMESTAMP NULL

INDEX idx_user_active (user_id, is_active)
INDEX idx_phone (phone)
UNIQUE(user_id, email, deleted_at)
UNIQUE(user_id, cpf, deleted_at)
```

### 6.4 Entidade: payments

```sql
id: UUID PRIMARY KEY
user_id: UUID FOREIGN KEY REFERENCES users
student_id: UUID FOREIGN KEY REFERENCES students
reference_month: INT NOT NULL
reference_year: INT NOT NULL
original_amount: DECIMAL(10,2) NOT NULL
final_amount: DECIMAL(10,2) NOT NULL
due_date: DATE NOT NULL
paid_date: DATE NULL
payment_method: ENUM('pix','boleto','cash','transfer','other')
status: ENUM('pending','overdue','paid','cancelled')
efibank_txid: VARCHAR(255) UNIQUE
pix_copy_paste: TEXT
pix_qrcode_url: VARCHAR(500)
pix_expires_at: TIMESTAMP
boleto_url: VARCHAR(500)
notes: TEXT
created_at: TIMESTAMP DEFAULT NOW()
updated_at: TIMESTAMP DEFAULT NOW()
deleted_at: TIMESTAMP NULL

INDEX idx_user_status (user_id, status, due_date)
INDEX idx_student_ref (student_id, reference_year, reference_month)
UNIQUE(student_id, reference_month, reference_year, deleted_at)
```

### 6.5 Entidade: notifications

```sql
id: UUID PRIMARY KEY
user_id: UUID FOREIGN KEY REFERENCES users
student_id: UUID FOREIGN KEY REFERENCES students
payment_id: UUID FOREIGN KEY REFERENCES payments NULL
type: ENUM('charge','reminder','notice','thanks')
message_template: TEXT NOT NULL
message_sent: TEXT NOT NULL
sent_at: TIMESTAMP DEFAULT NOW()

INDEX idx_user_sent (user_id, sent_at)
INDEX idx_student_sent (student_id, sent_at)
```

### 6.6 Entidade: schedules

```sql
id: UUID PRIMARY KEY
user_id: UUID FOREIGN KEY REFERENCES users
student_id: UUID FOREIGN KEY REFERENCES students
scheduled_at: TIMESTAMP NOT NULL
duration_minutes: INT DEFAULT 60
location: VARCHAR(255)
status: ENUM('scheduled','completed','cancelled','missed')
attendance: ENUM('present','absent','justified') NULL
notes: TEXT
created_at: TIMESTAMP DEFAULT NOW()
updated_at: TIMESTAMP DEFAULT NOW()

INDEX idx_user_scheduled (user_id, scheduled_at)
INDEX idx_student_scheduled (student_id, scheduled_at)
```

### 6.7 Entidade: pre_bookings

```sql
id: UUID PRIMARY KEY
user_id: UUID FOREIGN KEY REFERENCES users
name: VARCHAR(255) NOT NULL
phone: VARCHAR(20) NOT NULL
email: VARCHAR(255)
class_type_id: UUID FOREIGN KEY REFERENCES class_types
preferred_date: DATE NOT NULL
preferred_time: TIME NOT NULL
age: INT
source: VARCHAR(100)
message: TEXT
status: ENUM('pending','confirmed','converted','cancelled')
ip_address: VARCHAR(45)
user_agent: TEXT
converted_to_student_id: UUID FOREIGN KEY REFERENCES students NULL
confirmed_at: TIMESTAMP NULL
cancelled_at: TIMESTAMP NULL
cancellation_reason: TEXT
created_at: TIMESTAMP DEFAULT NOW()
updated_at: TIMESTAMP DEFAULT NOW()

INDEX idx_user_status (user_id, status, created_at)
```

### 6.8 Entidade: pre_enrollments

```sql
id: UUID PRIMARY KEY
user_id: UUID FOREIGN KEY REFERENCES users
name: VARCHAR(255) NOT NULL
cpf: VARCHAR(14) NOT NULL
birth_date: DATE NOT NULL
email: VARCHAR(255) NOT NULL
phone: VARCHAR(20) NOT NULL
rg: VARCHAR(20)
address_zip: VARCHAR(9) NOT NULL
address_street: VARCHAR(255) NOT NULL
address_number: VARCHAR(10) NOT NULL
address_complement: VARCHAR(100)
address_neighborhood: VARCHAR(100) NOT NULL
address_city: VARCHAR(100) NOT NULL
address_state: VARCHAR(2) NOT NULL
guardian_name: VARCHAR(255)
guardian_cpf: VARCHAR(14)
guardian_phone: VARCHAR(20)
class_type_id: UUID FOREIGN KEY REFERENCES class_types
due_day: INT NOT NULL
source: VARCHAR(100)
rg_document_url: VARCHAR(500)
address_proof_url: VARCHAR(500)
contract_text: TEXT NOT NULL
contract_accepted: BOOLEAN DEFAULT FALSE
contract_accepted_at: TIMESTAMP
contract_ip: VARCHAR(45)
terms_accepted: BOOLEAN DEFAULT FALSE
status: ENUM('pending_approval','approved','converted','rejected','expired')
rejection_reason: TEXT
approved_at: TIMESTAMP NULL
converted_to_student_id: UUID FOREIGN KEY REFERENCES students NULL
converted_at: TIMESTAMP NULL
ip_address: VARCHAR(45)
user_agent: TEXT
created_at: TIMESTAMP DEFAULT NOW()
updated_at: TIMESTAMP DEFAULT NOW()

INDEX idx_user_status (user_id, status, created_at)
INDEX idx_cpf (cpf)
```

### 6.9 Entidade: public_form_settings

```sql
id: UUID PRIMARY KEY
user_id: UUID FOREIGN KEY REFERENCES users UNIQUE
booking_slug: VARCHAR(100) UNIQUE NOT NULL
enrollment_slug: VARCHAR(100) UNIQUE NOT NULL
logo_url: VARCHAR(500)
primary_color: VARCHAR(7) DEFAULT '#3B82F6'
secondary_color: VARCHAR(7) DEFAULT '#10B981'
welcome_message: TEXT
booking_enabled: BOOLEAN DEFAULT TRUE
enrollment_enabled: BOOLEAN DEFAULT TRUE
contract_template: TEXT NOT NULL
contract_clauses: TEXT
notify_email: BOOLEAN DEFAULT TRUE
notify_in_app: BOOLEAN DEFAULT TRUE
recaptcha_enabled: BOOLEAN DEFAULT FALSE
max_submissions_per_day: INT DEFAULT 10
created_at: TIMESTAMP DEFAULT NOW()
updated_at: TIMESTAMP DEFAULT NOW()

INDEX idx_booking_slug (booking_slug)
INDEX idx_enrollment_slug (enrollment_slug)
```

---

## 7. FLUXOS DE USU√ÅRIO

### 7.1 Onboarding (Primeiro Acesso)

```
1. Cadastro (email/senha)
2. Confirmar email
3. Completar perfil
4. Configurar dados financeiros
5. Criar primeiro tipo de aula
6. Cadastrar primeiro aluno
7. Gerar primeira mensalidade
8. Tour guiado
```

### 7.2 Cobran√ßa Mensal Recorrente

```
1. In√≠cio do m√™s
2. Dashboard
3. "Gerar Mensalidades do M√™s"
4. Confirma gera√ß√£o
5. Revisa inadimplentes
6. Seleciona alunos
7. "Cobrar Selecionados"
8. WhatsApp abre sequencialmente
9. Professor envia
10. Aguarda pagamentos
```

### 7.3 Pagamento via PIX

```
1. Aluno recebe cobran√ßa
2. Copia PIX
3. Abre app do banco
4. Faz pagamento
5. EfiBank processa
6. Webhook ‚Üí Sistema
7. Status: Paga
8. Notifica√ß√£o professor
9. Professor confirma
```

### 7.4 Formul√°rio P√∫blico

```
1. Interessado acessa link
2. Preenche formul√°rio
3. Submete
4. Sistema salva
5. Abre WhatsApp
6. Envia mensagem
7. Professor recebe notifica√ß√£o
8. Professor responde
9. Professor confirma/converte
```

---

## 8. SEGURAN√áA E COMPLIANCE

### 8.1 LGPD - Conformidade

**Direitos do Titular:**
- Acesso aos dados
- Corre√ß√£o de dados
- Exclus√£o de dados (direito ao esquecimento)
- Portabilidade (export JSON)

**Implementa√ß√£o:**
- Criptografia de dados sens√≠veis (AES-256)
- Logs de acesso e altera√ß√µes
- Termo de uso e pol√≠tica de privacidade
- Consentimento expl√≠cito
- DPO designado (futuro)

### 8.2 Seguran√ßa de Senha

- Hash: bcrypt (12 rounds)
- Valida√ß√£o: m√≠n. 8 caracteres, 1 letra, 1 n√∫mero
- Recupera√ß√£o: token expira em 1 hora
- For√ßa da senha: indicador visual

### 8.3 Autentica√ß√£o

- JWT: Access Token (15 min) + Refresh Token (7 dias)
- HTTPS obrigat√≥rio
- Rate limiting: 100 req/min por IP
- CSRF protection

### 8.4 Dados Sens√≠veis

**Criptografados (AES-256):**
- Credenciais EfiBank
- Documentos uploadados
- Dados banc√°rios

**Logs de Auditoria:**
- Login/logout
- Altera√ß√£o de valores
- Exclus√£o de dados
- Acesso a dados sens√≠veis

---

## 9. ROADMAP DE DESENVOLVIMENTO

### Sprint 1 (2 semanas) - MVP Core

**Objetivo:** Sistema funcional b√°sico

- ‚úÖ Autentica√ß√£o (login/cadastro/logout)
- ‚úÖ CRUD Tipos de Aula
- ‚úÖ CRUD Alunos
- ‚úÖ CRUD Mensalidades (sem PIX)
- ‚úÖ Dashboard b√°sico
- ‚úÖ Notifica√ß√£o WhatsApp (link)
- ‚úÖ Deploy teste

**Entreg√°vel:** Professor gerencia alunos e mensalidades

---

### Sprint 2 (2 semanas) - Financeiro + EfiBank

**Objetivo:** Automatizar cobran√ßas

- ‚úÖ Integra√ß√£o EfiBank (PIX)
- ‚úÖ Webhook EfiBank
- ‚úÖ Gr√°ficos Dashboard
- ‚úÖ Filtros avan√ßados
- ‚úÖ Templates notifica√ß√£o
- ‚úÖ Hist√≥rico notifica√ß√µes
- ‚úÖ Formul√°rios p√∫blicos (pr√©-agendamento + matr√≠cula)
- ‚úÖ Contratos digitais

**Entreg√°vel:** Professor gera PIX e recebe baixa autom√°tica + capta√ß√£o de leads

---

### Sprint 3 (2 semanas) - Relat√≥rios + UX

**Objetivo:** Melhorar usabilidade

- ‚úÖ Relat√≥rios export√°veis
- ‚úÖ Agenda de aulas
- ‚úÖ Controle de presen√ßa
- ‚úÖ Gera√ß√£o de boleto
- ‚úÖ Configura√ß√µes avan√ßadas
- ‚úÖ Melhorias UX

**Entreg√°vel:** Sistema completo profissional

---

### Sprint 4 (2 semanas) - Polimento + Lan√ßamento

**Objetivo:** Produ√ß√£o

- ‚úÖ Testes E2E
- ‚úÖ Onboarding guiado
- ‚úÖ Tour interativo
- ‚úÖ Documenta√ß√£o
- ‚úÖ Otimiza√ß√µes
- ‚úÖ Deploy produ√ß√£o
- ‚úÖ Beta fechado

**Entreg√°vel:** Produto pronto para clientes


## 10. STACK TECNOL√ìGICA

### Frontend
- **bootstrap
### Backend
- **php
### Infraestrutura
- **
---

## 11. CRIT√âRIOS DE SUCESSO

### T√©cnicos
- ‚úÖ 100% endpoints com testes
- ‚úÖ Coverage > 80%
- ‚úÖ Performance < 3s
- ‚úÖ Zero critical bugs
- ‚úÖ Uptime > 99%

### Neg√≥cio
- ‚úÖ 50 professores beta em 1 m√™s
- ‚úÖ NPS > 40
- ‚úÖ Churn < 10%/m√™s
- ‚úÖ 10% convers√£o free ‚Üí paid

### Usu√°rio
- ‚úÖ Cadastro aluno < 1 min
- ‚úÖ Cobran√ßa < 30s
- ‚úÖ Satisfa√ß√£o > 4.5/5
- ‚úÖ Onboarding < 5 min

---

**Fim do Documento**

---

**Pr√≥ximos Documentos:**
1. Diagrama ERD visual
2. Especifica√ß√£o completa API REST
3. Prot√≥tipos detalhados (Figma)
4. Plano de testes
5. Manual do usu√°rio